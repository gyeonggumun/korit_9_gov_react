<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div class="container">
      <div class="input-container"></div>
      <div class="table-container"></div>
    </div>

    <script>
      // 키보드로 입력한 값을 저장할 객체, 초기값 : ""(빈 문자열)
      let inputValues = {
        username: "",
        password: "",
      };

      //테이블 구조 정의 객체
      let tableData = {
        columns: ["username", "password"],
        rows: [],
      };

      //input 태그를 생성하기 위한 컴포넌트(함수)
      function textInput({ className, name, value, onKeyUp }) {
        const input = document.createElement("input"); //<input> 태그 생성 - 디폴트타입 : text
        input.classList.add(className); //클래스 추가
        input.name = name; //name="" 속성
        input.value = value; //value="" 값
        input.onkeyup = onKeyUp; //이벤트핸들러 연결

        return input;
      }

      //username 입력 시 추가할 이벤트 함수?
      function usernameTextInput() {
        let props = {
          //props 로 값들을 한번 대입해줌
          //class, name, value, onKeyup 속성들 설정
          className: "username-input",
          name: "username",
          value: inputValues.username,
          onKeyUp: (e) => {
            //onKeyUp : event 객체를 받음 - 현재 일어난 이벤트, 타겟, 요소...
            console.log("키입력");
            console.log(e.target.value);
            inputValues = {
              ...inputValues, //기존 객체 안의 값 그대로 가져옴 - spread 문법이용
              [e.target.name]: e.target.value, //name 키에 새 값 추가
              //현재 이벤트 일어난 객체 - 자기자신
              //e.target.name : username 문자열 / e.target.value : 키보드로 입력한 값
            };
          },
        };

        return textInput(props); //textInput 함수의 리턴값 -> input 요소 반환
      }

      //username 과 동일하게 Input 업데이트 함수
      function passwordTextInput() {
        let props = {
          className: "password-input",
          name: "password",
          value: inputValues.password,
          onKeyUp: (e) => {
            console.log("키입력");
            console.log(e.target.value);
            inputValues = {
              ...inputValues,
              [e.target.name]: e.target.value,
            };
          },
        };
        return textInput(props);
      }

      //button 재사용하기 위한 함수 - class, text, onClick 핸들러 속성 설정
      function button({ className, text, onClick }) {
        const button = document.createElement("button");
        button.classList.add(className);
        button.innerText = text;
        button.onclick = onClick;
        return button;
      }

      //registerButton 클릭되면 테이블에 추가하는 함수
      function registerButton() {
        let props = {
          className: "register-button",
          text: "추가",
          onClick: (e) => {
            console.log("추가버튼 클릭!");
            const { username, password } = inputValues; //inputBalues 에서 username, password 꺼내
            tableData.rows.push([username, password]); //새로운 행 ([usename, password]) 형태로 tableData.rows 에 추가
            tableRender(); //tableRender 호출: 테이블 재생성
          },
        };
        return button(props);
      }

      // 테이블 생성 실행 부분
      function table({ columns, rows }) {
        //구조분해로 columns, rows 키밸류로 받아옴
        const thead = document.createElement("thead");
        const columnsTr = document.createElement("tr");
        columns.forEach((text) => {
          //columns 배열을 순회해서 컬럼명을 td 에 넣음-tr 에 추가
          const td = document.createElement("td");
          console.log(td);
          td.innerText = text; //td로 묶은 username 만들어짐
          columnsTr.appendChild(td); //td 를 tr 에 추가
        });
        thead.appendChild(columnsTr);

        //tbody 만들기 - rows 개수만큼 tr 만들어줌
        //row 당 td 를 받아와야함 - td 2개로 이루어진 tr 1개를 계속 추가
        //["test", "1234"]  의 형태로 td 로 만들고 tr 에 추가
        const tbody = document.createElement("tbody");
        rows.forEach((row) => {
          const rowTr = document.createElement("tr");
          row.forEach((text) => {
            const td = document.createElement("td");
            td.innerText = text;
            rowTr.appendChild(td);
          });
          tbody.appendChild(rowTr);
        });
        const table = document.createElement("table");

        table.appendChild(thead);
        table.appendChild(tbody);

        return table;
      }

      //render 함수 - 여기서 tableRender 를 최초 호출함
      //input-container 요소(태그)에 username/password input, register 버튼 차례로 붙임
      function render() {
        const inputContainer = document.querySelector(".input-container"); //input-container 요소에
        inputContainer.appendChild(usernameTextInput());
        inputContainer.appendChild(passwordTextInput());
        inputContainer.appendChild(registerButton());

        tableRender(); //최초 tableRender
      }

      //tableRender 호출될 때마다 일단 tableContainer 를 비움
      // -> 새로운 테이블을 만듦 - let tableData 의 column 과 row 정보를 가지고
      // -> table ({colymns, rows}) 부분으로 감
      //table 에 tr, td 추가하는 함수 실행됨
      //
      function tableRender() {
        const tableContainer = document.querySelector(".table-container");
        tableContainer.innerHTML = ""; // 기존 테이블 초기화
        tableContainer.appendChild(table(tableData)); //tableData 새로 만들어진 걸 붙여서 업데이트
      }

      render(); //페이지 로드되면 -> input 2개, button 가져옴

      /**
       * 페이지 로드 -> render() 실행 -> input 2개, register 버튼 표시됨
       * username/password, 즉 input 창에 입력 시 onKeyUp 이벤트 실행
       * register 버튼 클릭 -> registerButton 의 onClick 실행
       * -> tableData.rows 에 새로운 행으로 추가됨 - 입력한 inputValues 들이
       * -> tableRender() 로 테이블 업데이트
       */
    </script>
  </body>
</html>
